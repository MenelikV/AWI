<div class="container-fluid tab-container">

    <nav>
      <div class="nav nav-tabs" id="nav-tab" role="tablist">
        <a style="font-size:1.2rem" class="nav-item nav-link active" id="nav-home-tab" data-toggle="tab" href="#nav-home"
          role="tab" aria-controls="nav-home" aria-selected="true">Summary</a>
        <a style="font-size:1.2rem" class="nav-item nav-link" id="nav-profile-tab" data-toggle="tab" href="#nav-profile"
          role="tab" aria-controls="nav-profile" aria-selected="false">Output</a>
        <a style="font-size:1.2rem" class="nav-item nav-link" id="nav-filters-tab" data-toggle="tab" href="#nav-filters"
        role="tab" aria-controls="nav-filters" aria-selected="false">Filters</a>
        <a style="font-size:1.2rem" class="nav-item nav-link" id="nav-colors-tab" data-toggle="tab" href="#nav-colors"
        role="tab" aria-controls="nav-colors" aria-selected="false">Colors</a>
        <a style="font-size:1.2rem" class="nav-item nav-link" id="nav-chart-tab" data-toggle="tab" href="#nav-chart"
        role="tab" aria-controls="nav-chart" aria-selected="false">Chart</a>
      </div>
    </nav>


    <div class="tab-content" id="nav-tabContent">

      <!-- FIRST TAB-->
      <div class="tab-pane fade show active" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab">
        <br>

        <!-- End title and Activity container-->

        <div class="row">
          <div class="col md-12">
            <!-- Flight Summary container -->
            <div class="container-fluid" style="background-color:white;">
              <h4 style="padding-top:0.5rem;">
                Flight Summary
              </h4>
              <%- include flight-summary.ejs %>
            </div>
            <!-- End Flight Summary container -->
          </div>

        </div>

      </div>
      <!-- END FIRST TAB-->

      <!-- SECOND TABB-->

      <div class="tab-pane fade" id="nav-profile" role="tabpanel" aria-labelledby="nav-profile-tab">
        <br>
        <div class="col md-12">
          <!-- PVOL container -->
          <div class="container-fluid" style="background-color:white; overflow:auto;">
            <h4 style="padding-top:0.5rem;">
              <%= (name) %>
              <% if(data.full[0].START !== undefined) {%>
                <div style="float:right">
                  <label for="">Phases</label>
                  <button id="phaseSwitch" type="button" class="btn btn-xs btn-toggle" data-toggle="button" aria-pressed="false"
                    autocomplete="off">
                    <div class="handle"></div>
                  </button>
                  <label for="">Full Flight</label>
                </div>
              <%}%>
            </h4>

            <% if(filterTrigger) { %>
              <div style="padding-bottom:1rem;overflow: auto;">
                <button type="button" class=" btn-sm btn-warning" role="button" data-toggle="collapse" href="#filter_errors"
                  aria-expanded="false" aria-controls="filter_errors" style="color:white; cursor:pointer;"><strong>Filter
                    Trigger</strong> <i class="fa fa-warning fa-md"></i></button>
              </div>
  
              <div id="filter_errors" class="collapse">
                    <div style="max-height: 150px; overflow-y: scroll;">
                  <% for(var i=0; i< filterType.length; i++) { %>
                  <% if (filterType[i]["raiseError"] == true) {%>
                  <div style="font-size:15px;">
                    Error with parameter <strong style="text-decoration: underline;">
                      <%=filterType[i]["parameter"].replace(/_/g, " ")%></strong>,
                    type <strong style="text-decoration: underline;">
                      <%=filterType[i]["type"]%></strong> and phase <strong style="text-decoration: underline;">
                      <%=filterType[i]["phase"]%></strong>
                    not found.</div>
                  <% } %>
                  <% } %>
                    </div>
              </div>
              <% } %>

            <table id="pvol" class="table overview_table text-left">

              <thead>
                <tr>
                  <% headers.push("ERRORS") %>
                  <% for(var i=0; i< headers.length; i++) { %>
                  <%if(headers[i] == "PHASE" || headers[i] == "START" ||  headers[i] == "END" || headers[i] == "ERRORS") {%>
                  <th>
                    <%= headers[i] %>
                  </th>
                  <% } }%>
                </tr>
              </thead>


              <tbody>
                <!-- Iterate over errors rows-->
                <% for(var j=0; j< data.phases.length; j++) { %>
                <tr class="hover" data-target="<%='#demo_'+j%>" id="<%='row-demo_'+j%>" >
                  <% var errorTypes = Object.keys(errorMap.phases[j]) %>

                  <!-- Iterate over each field data-->
                  <% for(var k=0; k< headers.length; k++) { %>

                  <%if(headers[k] == "START") {%>
                  <td>
                    GMT
                    <%=  data.phases[j][headers[k]] %>
                  </td>
                  <% }else if ( headers[k] == "END") { %>
                  <td>
                    GMT
                    <%=  data.phases[j][headers[k]] %>
                    <br><br>

                  </td>
                  <% } else if(headers[k] == "PHASE"){%>
                  <td>
                    <%= data.phases[j][headers[k]] %>
                  </td>
                  <%} else if (headers[k] == "ERRORS") {%>
                  <td>
                    <% if (!errorTypes.length) {%>
                    <strong style="color:green"> <i class="fa fa-minus fa-sm"></i> </strong>
                    <%} else{  %>
                    <% if (errorTypes.length <=3) {%>
                    <%  for(let type of errorTypes){%>
                      <a class="type" id="<%='subtable_'+j+'-'+ type %>" role="button"><%= type %></a>: <strong
                      style="color:red;"><%= errorMap.phases[j][type] %></strong>
                    <br>

                    <%}%>

                        <%} else {%>
                    <div style="overflow:auto; width: 200px;
                      height: 80px;">
                      <%  for(let type of errorTypes){%>

                        <a class="type" id="<%='subtable_'+j+'-'+ type %>" role="button"><%= type %></a>: <strong
                        style="color:red;"><%= errorMap.phases[j][type] %></strong>
                      <br>

                      <%}%>
                  </div>
                  <%}}%>
                  </td>
                  <% } }%>
                </tr>

                <!--Start collapse div-->
                <tr class="hidden">
                  <td colspan="4">
                    <div id="<%='demo_'+j%>" class="collapse text-center">
                      <!-- Start subtable-->
                      <% if(CSVerrors.phases[j].length) {  %>
                      <table id="<%='subtable_'+j%>" class="sub_overview table-md">
                        <thead>
                          <tr>
                            <% for(var i=0; i< CSVheaders.length; i++) { %>
                            <th id="<%= CSVheaders[i] %>">
                              <%= CSVheaders[i] %>
                            </th>
                            <% } %>
                            <th style="width: 15%">
                              ACTIONS
                            </th>
                          </tr>
                        </thead>

                        <tbody style="background-color:rgba(137, 202, 255, 0.075)">

                          <% for(var i=0; i< CSVerrors.phases[j].length; i++) { %>
                          <tr>
                            <% for(var k=0; k < CSVheaders.length; k++) { %>
                            <td id="<%=CSVheaders[k]%>">
                              <%= CSVerrors.phases[j][i][CSVheaders[k]] %>

                            </td>
                            <% } %>

                            <td style='white-space: nowrap'>
                              <button type="button" class=" btn-light btn-sm" data-mr="<%=mr%>" aria-hidden="true"
                                data-id="see_par">
                                <span class="fa fa-line-chart fa-lg" title="See Parameter"></span>
                              </button>

                              <button type="button" class=" btn-light btn-sm" aria-hidden="true" data-id="filter_par">
                                <i class="fa fa-eyedropper fa-lg" title="Filter"></i>
                              </button>

                              <button type="button" class=" btn-light btn-sm" aria-hidden="true" data-id="search_par"">
                                       <i class="
                                fa fa-search fa-lg" title="Search"></i>
                              </button>
                            </td>
                          </tr>
                          <% } %>
                        </tbody>
                      </table>
                      <!--End subtable-->
                      <%}%>
                    </div>
                  </td>
                </tr>
                <!-- End collapse div -->
                <% } %>
              </tbody>
            </table>

            <!-- FULL FLIGHT TABLE -->
            <table id="full" class="table overview_table text-left" style="width:100%; display:none">
              <thead>
                <tr>
                  <% for(var i=0; i< headers.length; i++) { %>
                    <%if(headers[i] == "PHASE" || headers[i] == "START" ||  headers[i] == "END" || headers[i] == "ERRORS") {%>
                    <th>
                      <%= headers[i] %>
                    </th>
                    <% } 
                  } %>
                </tr>
              </thead>
              <tbody>
                  <!-- Iterate over errors rows-->
                  <% for(var j=0; j< data.full.length; j++) { %>
                  <tr class="hover" data-target="<%='#full_demo_'+j%>" id="<%='row-full_demo_'+j%>">
                    <% var errorTypes = Object.keys(errorMap.full) %>
                    <!-- Iterate over each field data-->
                    <% for(var k=0; k< headers.length; k++) { %>
                    <%if(headers[k] == "START") {%>
                    <td>
                      GMT
                      <%=  data.full[j][headers[k]] %>
                    </td>
                    <% }else if ( headers[k] == "END") { %>
                    <td>
                      GMT
                      <%=  data.full[j][headers[k]] %>
                    </td>
                    <% } else if(headers[k] == "PHASE"){%>
                    <td>
                      <%= data.full[j][headers[k]] %>
                    </td>
                    <%} else if(headers[k] == "ERRORS"){%>
                      <td>
                        <% if(!errorTypes.length){%>
                          <strong style="color:green"> <i class="fa fa-minus fa-sm"></i> </strong>
                          <%}
                          else{%>
                            <% if (errorTypes.length <=3) {%>
                              <%  for(let type of errorTypes){%>
                                <a class="type" id="<%='full_subtable_'+j+'-'+ type %>" role="button"><%= type %></a>: <strong
                                style="color:red;"><%= errorMap.full[type] %></strong>
                              <br>
          
                              <%}%>
          
                                  <%} else {%>
                              <div style="overflow:auto; width: 200px;
                                height: 80px;">
                                <%  for(let type of errorTypes){%>
          
                                  <a class="type" id="<%='full_subtable_'+j+'-'+ type %>" role="button"><%= type %></a>: <strong
                        style="color:red;"><%= errorMap.full[type] %></strong>
                      <br>
          
                                <%}%>
                            </div>
                            <%}%>
                            <%}%>
                      </td>
                      <%}%>
                    <%}%>
                  </tr>
  
                  <!--Start collapse div-->
                  <tr class="hidden">
                    <td colspan="4">
                      <div id="<%='full_demo_'+j%>" class="collapse text-center">
                        <!-- Start subtable-->
                        <% if(CSVerrors.full[j].length) {  %>
                        <table id="<%='full_subtable_'+j%>" class="sub_overview table-md">
                          <thead>
                            <tr>
                              <% for(var i=0; i< CSVheaders.length; i++) { %>
                              <th id="<%=CSVheaders[i]%>">
                                <%= CSVheaders[i] %>
                              </th>
                              <% } %>
                              <th style="width: 15%">
                                ACTIONS
                              </th>
                            </tr>
                          </thead>
  
                          <tbody style="background-color:rgba(137, 202, 255, 0.075)">
  
                            <% for(var i=0; i< CSVerrors.full[j].length; i++) { %>
                            <tr>
                              <% for(var k=0; k < CSVheaders.length; k++) { %>
                              <td id="<%=CSVheaders[k]%>">
                                <font style='<%="color:"+CSVerrors.full[j][i].STYLE%>'>
                                    <%= CSVerrors.full[j][i][CSVheaders[k]] %>
                                </font>
  
                              </td>
                              <% } %>
  
                              <td style='white-space: nowrap'>
                                <button type="button" class=" btn-light btn-sm" data-mr="<%=mr%>" aria-hidden="true"
                                  data-id="see_par">
                                  <span class="fa fa-line-chart fa-lg" title="See Parameter"></span>
                                </button>
  
                                <button type="button" class=" btn-light btn-sm" aria-hidden="true" data-id="filter_par">
                                  <i class="fa fa-eyedropper fa-lg" title="Filter"></i>
                                </button>
  
                                <button type="button" class=" btn-light btn-sm" aria-hidden="true" data-id="search_par"">
                                         <i class="
                                  fa fa-search fa-lg" title="Search"></i>
                                </button>
                              </td>
                            </tr>
                            <% } %>
                          </tbody>
                        </table>
                        <!--End subtable-->
                        <%}%>
                      </div>
                    </td>
                  </tr>
                  <!-- End collapse div -->
                  <% } %>
              </tbody>
            </table>
          </div>
          <!-- End PVOL container -->
        </div>
      </div>
      <!-- END SECOND TAB -->

     <!-- BEGIN THIRD TAB -->
     <div class="tab-pane fade" id="nav-filters" role="tabpanel" aria-labelledby="nav-filters-tab">
        <br>
        <% if(filterHeader.length) { %>
        <div class="col md-12">
          <!-- Applied filters containers -->
          <div class="container-fluid" style="background-color:white; overflow:auto;padding-bottom:10px">
            <h4 style="padding-top:0.5rem;">
              Applied Filters
            </h4>
            <table id="applied_filters" class="table text-left">
              <thead>
                <tr>
                  <% for(var i=0; i< filterHeader.length-1; i++) { %>
                  <th style="text-transform: uppercase">
                    <%= filterHeader[i] %>
                  </th>
                  <% }%>
                </tr>
              </thead>
              <tbody style="background-color:rgba(137, 202, 255, 0.075)">
  
                <% for(var l=0; l < filterType.length; l++){%>
                <tr>
                  <% for(var i=0; i < filterHeader.length-1; i++){%>
  
                  <td><%= filterType[l][filterHeader[i]] %></td>
  
                  <%}%> 
                    </tr>
                    <%}%>
  
              </tbody>
            </table>
          </div>
        </div>
        <% } else { %>
        <div class="container" style="background-color:rgba(255, 255, 255, 0.836); overflow:auto; padding:10px;">
          <div style="padding:2rem">
            <h2><strong style="color:#1D809F">No filters found</strong> </h2>
            <hr />
            <div class="help">
              <h5>This flight has no filters applied up to this moment.</h5><br>
  
            </div>
          </div>
        </div>
        <%}%>
      </div>
      <!-- END THIRD TAB --> 
      <!-- BEGIN FOURTH TAB -->
     <div class="tab-pane fade" id="nav-colors" role="tabpanel" aria-labelledby="nav-colors-tab">
        <br>
        <% if(colorHeader.length) { %>
        <div class="col md-12">
          <!-- Applied filters containers -->
          <div class="container-fluid" style="background-color:white; overflow:auto;padding-bottom:10px">
            <h4 style="padding-top:0.5rem;">
              Coloring Scheme
            </h4>
            <table id="applied_colors" class="table text-left">
              <thead>
                <tr>
                  <% for(var i=0; i< colorHeader.length; i++) { %>
                  <th style="text-transform: uppercase">
                    <%= colorHeader[i] %>
                  </th>
                  <% }%>
                </tr>
              </thead>
              <tbody style="background-color:rgba(137, 202, 255, 0.075)">
  
                <% for(var l=0; l < colorType.length; l++){%>
                <tr>
                  <% for(var i=0; i < colorHeader.length; i++){%>
                  <td>
                      <%if(colorHeader[i].toUpperCase()==="COLOR"){%>
                        <font color="<%= colorType[l][colorHeader[i]] %>">
                          <%= colorType[l][colorHeader[i]] %>
                        </font>
                        <%}else{%>
                          <%= colorType[l][colorHeader[i]] %>
                          <%}%>  
                  </td>
  
                  <%}%> 
                    </tr>
                    <%}%>
  
              </tbody>
            </table>
          </div>
        </div>
        <% } else { %>
        <div class="container" style="background-color:rgba(255, 255, 255, 0.836); overflow:auto; padding:10px;">
          <div style="padding:2rem">
            <h2><strong style="color:#1D809F">No Coloring Scheme found</strong> </h2>
            <hr />
            <div class="help">
              <h5>This flight has no coloring scheme applied up to this moment.</h5><br>
  
            </div>
          </div>
        </div>
        <%}%>
      </div>
      <!-- END FOURTH TAB -->
      <!-- BEGIN FIFH TAB -->
      <div class="tab-pane fade" id="nav-chart" role="tabpanel" aria-labelledby="nav-chart-tab">
          <br>
          <div class="col md-12">
            <!-- Chart container -->
            <div id="anemoChartContainer" class="container-fluid" style="background-color:white; overflow:auto;">
              <h4 style="padding-top:0.5rem;">
              <div class="d-flex justify-content-center">
                  <button type="button" class="btn btn-primary btn-lg" id="load_data" data-mr="<%=mr%>">Load Data</button>
              </div>
            </div>
          </div>
      </div>   
      <!--END FIFTH TAB-->
  </div>
</div>
<!-- Modal -->
<%- include ../../search-modal.ejs %>
<%- include ../../filter-modal.ejs %>
<%- include ../../plot-modal.ejs %>
<%- include ../../spinner-modal.ejs %>